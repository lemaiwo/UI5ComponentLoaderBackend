"use strict";                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }                                                                                                      
                                                                                                                                                                                                                                                               
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }                                                                 
                                                                                                                                                                                                                                                               
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n =+
== "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }                                                                                             
                                                                                                                                                                                                                                                               
function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }                                                                                                 
                                                                                                                                                                                                                                                               
function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }                                                                                                                                                                    
                                                                                                                                                                                                                                                               
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }                                                                        
                                                                                                                                                                                                                                                               
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropert+
yDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }                                                                                                                                                                    
                                                                                                                                                                                                                                                               
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else+
 if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key))+
; }); } } return target; }                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }                                              
                                                                                                                                                                                                                                                               
sap.ui.define(["be/wl/zcomploaderlib/objects/BaseObject", "sap/ui/core/Component", "./Param", "sap/base/strings/capitalize", "sap/f/library", "sap/ui/model/resource/ResourceModel"], function (BaseObject, Component, Param, capitalize, fioriLibrary, Resour+
ceModel) {                                                                                                                                                                                                                                                     
  "use strict";                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
  return BaseObject.extend("be.wl.CompLoaderApp.model.Component", {                                                                                                                                                                                            
    constructor: function constructor(data) {                                                                                                                                                                                                                  
      BaseObject.call(this, data);                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
      if (data.toParams) {                                                                                                                                                                                                                                     
        this.setParams(data.toParams.results);                                                                                                                                                                                                                 
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    setParams: function setParams(params) {                                                                                                                                                                                                                    
      this.params = params.map(function (param) {                                                                                                                                                                                                              
        return new Param(param);                                                                                                                                                                                                                               
      });                                                                                                                                                                                                                                                      
    },                                                                                                                                                                                                                                                         
    getConfig: function getConfig() {                                                                                                                                                                                                                          
      var _this = this;                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      return this.params.reduce(function (config, param) {                                                                                                                                                                                                     
        if (_this.fioriElements || param.seqnr !== "00000") {                                                                                                                                                                                                  
          if (!config[param.id]) {                                                                                                                                                                                                                             
            config[param.id] = [];                                                                                                                                                                                                                             
          }                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
          config[param.id].push(param.getConvertedValue());                                                                                                                                                                                                    
        } else {                                                                                                                                                                                                                                               
          config[param.id] = param.getConvertedValue();                                                                                                                                                                                                        
        }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        return config;                                                                                                                                                                                                                                         
      }, {});                                                                                                                                                                                                                                                  
    },                                                                                                                                                                                                                                                         
    getComponentId: function getComponentId() {                                                                                                                                                                                                                
      return this.componentid;                                                                                                                                                                                                                                 
    },                                                                                                                                                                                                                                                         
    getLevel: function getLevel() {                                                                                                                                                                                                                            
      return this.level_cl;                                                                                                                                                                                                                                    
    },                                                                                                                                                                                                                                                         
    getLayout: function getLayout() {                                                                                                                                                                                                                          
      var layout;                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
      switch (this.getView()) {                                                                                                                                                                                                                                
        case "master":                                                                                                                                                                                                                                         
          layout = fioriLibrary.LayoutType.OneColumn;                                                                                                                                                                                                          
          break;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        case "detail":                                                                                                                                                                                                                                         
          layout = fioriLibrary.LayoutType.TwoColumnsMidExpanded;                                                                                                                                                                                              
          break;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        case "detailDetail":                                                                                                                                                                                                                                   
          layout = fioriLibrary.LayoutType.ThreeColumnsEndExpanded;                                                                                                                                                                                            
          break;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        default:                                                                                                                                                                                                                                               
          layout = fioriLibrary.LayoutType.OneColumn;                                                                                                                                                                                                          
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      return this.layout || layout;                                                                                                                                                                                                                            
    },                                                                                                                                                                                                                                                         
    getViewAggregation: function getViewAggregation() {                                                                                                                                                                                                        
      switch (this.viewid) {                                                                                                                                                                                                                                   
        case "MA":                                                                                                                                                                                                                                             
          return "beginColumnPage";                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
        case "DE":                                                                                                                                                                                                                                             
          return "midColumnPage";                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
        case "DD":                                                                                                                                                                                                                                             
          return "endColumnPage";                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
        default:                                                                                                                                                                                                                                               
          return "beginColumnPage";                                                                                                                                                                                                                            
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    getViewAggregationAddFn: function getViewAggregationAddFn() {                                                                                                                                                                                              
      return "add" + capitalize(this.getViewAggregation());                                                                                                                                                                                                    
    },                                                                                                                                                                                                                                                         
    getViewAggregationRemoveFn: function getViewAggregationRemoveFn() {                                                                                                                                                                                        
      return "removeAll" + capitalize(this.getViewAggregation()) + "s";                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    getView: function getView() {                                                                                                                                                                                                                              
      switch (this.viewid) {                                                                                                                                                                                                                                   
        case "MA":                                                                                                                                                                                                                                             
          return "master";                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        case "DE":                                                                                                                                                                                                                                             
          return "detail";                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        case "DD":                                                                                                                                                                                                                                             
          return "detailDetail";                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        default:                                                                                                                                                                                                                                               
          return "master";                                                                                                                                                                                                                                     
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    isFioriElements: function isFioriElements() {                                                                                                                                                                                                              
      return this.fioriElements;                                                                                                                                                                                                                               
    },                                                                                                                                                                                                                                                         
    getUIComponent: function getUIComponent(params) {                                                                                                                                                                                                          
      var _this2 = this;                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
      if (this.UIComponent && (!this.isFioriElements() || !(params.data && params.data.startupParameters))) {                                                                                                                                                  
        return Promise.resolve({                                                                                                                                                                                                                               
          component: this.UIComponent,                                                                                                                                                                                                                         
          firsttime: false                                                                                                                                                                                                                                     
        });                                                                                                                                                                                                                                                    
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      params.config = this.getConfig();                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      if (params.data && params.data.startupParameters) {                                                                                                                                                                                                      
        var startupParametersData = params.data.startupParameters; // startupParameters : {                                                                                                                                                                    
        // 	Txt30: ["Open"]                                                                                                                                                                                                                                    
        // }                                                                                                                                                                                                                                                   
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      var startupParameters = {};                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
      if (this.isFioriElements()) {                                                                                                                                                                                                                            
        sap.ui.loader._.declareModule(this.componentid.replace(/\./g, "/") + "/changes/changes-bundle.json");                                                                                                                                                  
                                                                                                                                                                                                                                                               
        var startupParametersConfig = params.config;                                                                                                                                                                                                           
        startupParameters = params.startupParameters || {};                                                                                                                                                                                                    
      } //merge startup params                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      var allFields = _objectSpread(_objectSpread({}, startupParametersData), startupParametersConfig); // var startupParameters = {};                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      for (var field in allFields) {                                                                                                                                                                                                                           
        var _startupParameters$fi, _startupParameters$fi2;                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        startupParameters[field] = [];                                                                                                                                                                                                                         
        startupParametersData && startupParametersData[field] && (_startupParameters$fi = startupParameters[field]).push.apply(_startupParameters$fi, _toConsumableArray(startupParametersData[field]));                                                       
        startupParametersConfig && startupParametersConfig[field] && (_startupParameters$fi2 = startupParameters[field]).push.apply(_startupParameters$fi2, _toConsumableArray(startupParametersConfig[field]));                                               
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      return Component.create({                                                                                                                                                                                                                                
        // return Component.load({                                                                                                                                                                                                                             
        name: this.componentid,                                                                                                                                                                                                                                
        url: this.componenturl,                                                                                                                                                                                                                                
        height: "100%",                                                                                                                                                                                                                                        
        style: "height: 100%",                                                                                                                                                                                                                                 
        manifest: true,                                                                                                                                                                                                                                        
        async: true,                                                                                                                                                                                                                                           
        componentData: {                                                                                                                                                                                                                                       
          startupParameters: startupParameters,                                                                                                                                                                                                                
          input: params                                                                                                                                                                                                                                        
        }                                                                                                                                                                                                                                                      
      }).then(function (childComponent) {                                                                                                                                                                                                                      
        _this2.UIComponent = childComponent; //load i18n for fiori elements manually.                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        if (_this2.isFioriElements()) {                                                                                                                                                                                                                        
          var compModels = _this2.UIComponent.getManifestEntry("sap.ui5").models;                                                                                                                                                                              
                                                                                                                                                                                                                                                               
          for (var modelName in compModels) {                                                                                                                                                                                                                  
            if (compModels[modelName].type === "sap.ui.model.resource.ResourceModel") {                                                                                                                                                                        
              var bundleName = compModels[modelName].uri && _this2.UIComponent.getMetadata().getComponentName() + "." + compModels[modelName].uri.split(".")[0].replace(/\//gi, ".") || compModels[modelName].settings && compModels[modelName].settings.bundl+
eName;                                                                                                                                                                                                                                                         
              var i18nModel = new ResourceModel({                                                                                                                                                                                                              
                bundleName: bundleName                                                                                                                                                                                                                         
              });                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
              _this2.UIComponent.setModel(i18nModel, modelName);                                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
          }                                                                                                                                                                                                                                                    
        }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        return {                                                                                                                                                                                                                                               
          component: _this2.UIComponent,                                                                                                                                                                                                                       
          firsttime: true                                                                                                                                                                                                                                      
        };                                                                                                                                                                                                                                                     
      }).catch(function (error) {                                                                                                                                                                                                                              
        throw "Error create component";                                                                                                                                                                                                                        
      });                                                                                                                                                                                                                                                      
    },                                                                                                                                                                                                                                                         
    updateUIComponentInput: function updateUIComponentInput(params) {                                                                                                                                                                                          
      params.config = this.getConfig();                                                                                                                                                                                                                        
      this.UIComponent.setInput(params);                                                                                                                                                                                                                       
      /*if (typeof this.UIComponent !== "undefined") {                                                                                                                                                                                                         
      	params.config = this.getConfig();                                                                                                                                                                                                                       
      	this.UIComponent.setInput(params);                                                                                                                                                                                                                      
      } else {                                                                                                                                                                                                                                                 
      	setTimeout(function () {                                                                                                                                                                                                                                
      		this.updateUIComponentInput(params);                                                                                                                                                                                                                   
      	}.bind(this), 250);                                                                                                                                                                                                                                     
      }*/                                                                                                                                                                                                                                                      
    },                                                                                                                                                                                                                                                         
    setData: function setData(data) {                                                                                                                                                                                                                          
      this.data = data;                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    getData: function getData() {                                                                                                                                                                                                                              
      return this.data;                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    getJSON: function getJSON() {                                                                                                                                                                                                                              
      var component = this.getJSONObject(["viewid", "level_cl", "componentid", "data"]);                                                                                                                                                                       
      component.Data = this.data;                                                                                                                                                                                                                              
      component.params = this.params.map(function (param) {                                                                                                                                                                                                    
        return param.getJSON();                                                                                                                                                                                                                                
      });                                                                                                                                                                                                                                                      
      return component;                                                                                                                                                                                                                                        
    }                                                                                                                                                                                                                                                          
  });                                                                                                                                                                                                                                                          
});                                                                                                                                                                                                                                                            